@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* ==================================
   * VARIÁVEIS CSS — LIGHT / DARK MODE
   * ================================== */

  :root {
    --bg-primary:    #ffffff;
    --bg-secondary:  #f8fafc;
    --bg-card:       #ffffff;
    --text-primary:  #0f172a;
    --text-secondary:#475569;
    --border:        #e2e8f0;
    --brand:         #2563eb;
    --brand-hover:   #1d4ed8;
  }

  .dark {
    --bg-primary:    #0f172a;
    --bg-secondary:  #1e293b;
    --bg-card:       #1e293b;
    --text-primary:  #f1f5f9;
    --text-secondary:#94a3b8;
    --border:        #334155;
    --brand:         #3b82f6;
    --brand-hover:   #2563eb;
  }

  /* ==================================
   * ACESSIBILIDADE - WCAG 2.1 AA
   * ================================== */

  html {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    font-size: 16px;
    scroll-behavior: smooth;
    color-scheme: light dark;
  }

  body {
    @apply text-base;
    line-height: 1.6;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    transition: background-color 0.2s ease, color 0.2s ease;
  }

  body, html {
    overflow-x: hidden;
    max-width: 100vw;
  }

  /* ==================================
   * FOCUS STATES VISÍVEIS
   * ================================== */

  a:focus-visible,
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible,
  [role="button"]:focus-visible,
  [tabindex]:focus-visible {
    outline: 2px solid var(--brand);
    outline-offset: 2px;
  }

  /* ==================================
   * REDUCED MOTION
   * ================================== */

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* ==================================
   * ALTO CONTRASTE
   * ================================== */

  @media (prefers-contrast: high) {
    body {
      --tw-border-opacity: 1;
      border-color: rgb(0 0 0 / var(--tw-border-opacity));
    }
    button, a {
      text-decoration: underline;
    }
  }

  /* ==================================
   * DARK MODE AUTOMÁTICO (prefers-color-scheme)
   * ================================== */

  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
      --bg-primary:    #0f172a;
      --bg-secondary:  #1e293b;
      --bg-card:       #1e293b;
      --text-primary:  #f1f5f9;
      --text-secondary:#94a3b8;
      --border:        #334155;
      --brand:         #3b82f6;
      --brand-hover:   #2563eb;
    }
  }

  /* Links */
  a {
    color: var(--brand);
  }
  a:hover {
    color: var(--brand-hover);
  }

  /* Tamanhos mínimos de toque (44x44px) */
  button,
  a,
  [role="button"],
  input[type="button"],
  input[type="submit"],
  input[type="reset"] {
    min-height: 44px;
    min-width: 44px;
  }

  .icon-button {
    min-height: auto;
    min-width: auto;
  }
}

@layer components {
  /* ==================================
   * INPUTS
   * ================================== */

  .input {
    @apply w-full rounded-lg border-2 px-4 py-3 text-base transition;
    border-color: var(--border);
    background-color: var(--bg-card);
    color: var(--text-primary);
    min-height: 44px;
    line-height: 1.5;
  }

  .input::placeholder {
    color: var(--text-secondary);
  }

  .input:hover {
    border-color: var(--brand);
  }

  .input:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
  }

  .input-error {
    @apply border-red-500 focus:border-red-500;
    box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important;
  }

  label {
    @apply text-sm font-medium;
    color: var(--text-primary);
    line-height: 1.5;
  }

  /* ==================================
   * BOTÕES
   * ================================== */

  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-xl px-6 py-3 text-base font-semibold transition-all duration-200;
    min-height: 44px;
    line-height: 1.5;
  }

  .btn-primary {
    background-color: var(--brand);
    @apply text-white shadow hover:shadow-lg;
    @apply focus-visible:ring-4 focus-visible:ring-blue-500/30;
  }

  .btn-primary:hover {
    background-color: var(--brand-hover);
  }

  .btn-secondary {
    @apply bg-transparent border-2 font-semibold;
    border-color: var(--brand);
    color: var(--brand);
    @apply focus-visible:ring-4 focus-visible:ring-blue-500/30;
  }

  .btn-secondary:hover {
    background-color: color-mix(in srgb, var(--brand) 10%, transparent);
  }

  .btn-danger {
    @apply bg-red-600 text-white hover:bg-red-700;
    @apply focus-visible:ring-4 focus-visible:ring-red-500/30;
  }

  /* ==================================
   * CARDS
   * ================================== */

  .card {
    @apply rounded-xl border p-6 shadow-sm;
    background-color: var(--bg-card);
    border-color: var(--border);
  }

  /* ==================================
   * ALERTS
   * ================================== */

  .alert {
    @apply rounded-lg border-2 p-4 text-sm;
    line-height: 1.6;
  }

  .alert-info    { @apply border-blue-300 bg-blue-50 text-blue-900 dark:bg-blue-950 dark:border-blue-800 dark:text-blue-200; }
  .alert-success { @apply border-green-300 bg-green-50 text-green-900 dark:bg-green-950 dark:border-green-800 dark:text-green-200; }
  .alert-warning { @apply border-amber-300 bg-amber-50 text-amber-900 dark:bg-amber-950 dark:border-amber-800 dark:text-amber-200; }
  .alert-error   { @apply border-red-300 bg-red-50 text-red-900 dark:bg-red-950 dark:border-red-800 dark:text-red-200; }

  /* ==================================
   * SKIP LINKS
   * ================================== */

  .skip-link {
    @apply absolute -top-full left-0 z-50 bg-blue-600 px-6 py-3 text-white font-semibold;
    @apply focus:top-0 focus:outline-4 focus:outline-offset-2 focus:outline-white;
  }
}

/* ==================================
 * UTILITÁRIOS
 * ================================== */

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.focus-ring {
  @apply focus-visible:ring-4 focus-visible:ring-blue-500/30 focus-visible:outline-none;
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

/* ==================================
 * DARK MODE — COMPONENTES NATIVOS
 * ================================== */

.dark body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
}

.dark .card {
  background-color: var(--bg-card);
  border-color: var(--border);
}

.dark .input {
  background-color: var(--bg-secondary);
  border-color: var(--border);
  color: var(--text-primary);
}

/* ==================================
 * RESPONSIVIDADE — DASHBOARD
 * ================================== */

@media (max-width: 640px) {
  .dashboard-grid {
    grid-template-columns: 1fr !important;
  }

  .dashboard-stats {
    grid-template-columns: repeat(2, 1fr) !important;
  }

  .hide-on-mobile {
    display: none !important;
  }

  .full-width-mobile {
    width: 100% !important;
  }
}

@media (min-width: 641px) and (max-width: 1024px) {
  .dashboard-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

/* ==================================
 * ANIMAÇÕES
 * ================================== */

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

.animate-fade-in {
  animation: fadeIn 0.25s ease-out;
}

@keyframes shimmer {
  0%   { background-position: -200% 0; }
  100% { background-position:  200% 0; }
}

.skeleton {
  background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

.dark .skeleton {
  background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
